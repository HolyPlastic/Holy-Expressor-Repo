<!DOCTYPE html>
<html>


 <!-- #region 🔽🔽🔽 LOADING + head 🗿===================================------------------
____________________ -------->  
<head>
  <meta charset="UTF-8" />
  <title>Holy Expressor</title>

  <!-- 🧩 CSS FIRST: ensures styled paint before JS -->
  <link rel="stylesheet" href="css/styles.css" />

<!-- #region 🎨⚙️⚙️ CSS STYLE FUNCTION ===================================------------------>

<script>
(function STYLE_boot(){
  try {
    const theme = localStorage.getItem('he_theme') || 'default';
    document.documentElement.classList.add(`theme-${theme}`);

    // 💡 HEX → RGB
    function hexToRgb(hex) {
      const clean = hex.replace('#', '');
      const bigint = parseInt(clean, 16);
      const r = (bigint >> 16) & 255;
      const g = (bigint >> 8) & 255;
      const b = bigint & 255;
      return { r, g, b };
    }

    // 💡 RGB → HSL
    function rgbToHsl(r, g, b) {
      r /= 255; g /= 255; b /= 255;
      const max = Math.max(r, g, b);
      const min = Math.min(r, g, b);
      let h, s, l = (max + min) / 2;

      if (max === min) {
        h = s = 0; // gray
      } else {
        const d = max - min;
        s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
        switch (max) {
          case r: h = (g - b) / d + (g < b ? 6 : 0); break;
          case g: h = (b - r) / d + 2; break;
          case b: h = (r - g) / d + 4; break;
        }
        h /= 6;
      }

      return {
        h: Math.round(h * 360),
        s: Math.round(s * 100),
        l: Math.round(l * 100)
      };
    }

    // 🧮 Read CSS var, convert, and reassign
    const root = document.documentElement;
    const hex = getComputedStyle(root).getPropertyValue('--G-color-1').trim();
    const { r, g, b } = hexToRgb(hex);
    const { h, s, l } = rgbToHsl(r, g, b);

    // ✅ Preserve existing RGB pipeline (for opacity borders etc.)
    root.style.setProperty('--G-colour-1-RGB', `${r}, ${g}, ${b}`);

    // ✅ Add new HSL variables for CSS-controlled modifiers
    root.style.setProperty('--G-color-1-H', h);
    root.style.setProperty('--G-color-1-S', s + '%');
    root.style.setProperty('--G-color-1-L', l + '%');

  } catch (e) {
    console.warn('cy_styleBoot failed', e);
  }
})();
</script>
<!----_-_-_-_-_-_-_---------------------------------------\--\--->
<!-- #endregion ^^^ end🎨⚙️⚙️ ^^^ -->


  

  <!-- ⚙️ Core CEP dependencies (MUST stay synchronous) -->
  <script src="js/libs/CSInterface.js"></script>
  <script src="js/json2.js"></script>

  <!-- 🧠 Core editor bundle (CodeMirror) -->
  <script defer src="js/codemirror/codemirror-bundle.js"></script>
<!-- 💡 CM bundle is loaded above -->
<link rel="stylesheet" href="css/codemirror_styles.css"> <!-- uses globals from styles.css -->
  <!-- 🧩 Plugin modules (safe to defer) -->
  <script defer src="js/main_UTILS.js"></script>
  <script defer src="js/main_STATE.js"></script>
  <script defer src="js/main_FLYO.js"></script>
  <script defer src="js/main_MENU.js"></script>
  <script defer src="js/main_UI.js"></script>
  <script defer src="js/main_EXPRESS.js"></script>
  <script defer src="js/main_BUTTON_LOGIC_1.js"></script>
  <script defer src="js/main_SNIPPETS.js"></script>
  <script defer src="js/main_SEARCH_REPLACE.js"></script>
  <script defer src="js/main_DEV_INIT.js"></script>

  <!-- 🚀 Final entrypoint -->
  <script defer src="js/main.js"></script>
</head>



<body>

  <div id="appRoot">
  
  <header class="hdr hide-when-editor-maximized">
    <h2></h2>
  </header>



  <section class="tabs hide-when-editor-maximized">
   
 <!-- V1 — Flyover Trigger Button -->

        <button class="tab-btn" id="reloadPanel">Reload</button>
  <button  class="tab-btn" id="exposeBtn">Expose</button>

  <button id="quickAccessLaunchBtn" class="tab-btn">Quickpanel</button>


  </section>

<!----_-_-_-_-_-_-_---------------------------------------\--\--->
<!-- #endregion ^^^ EnndLoading 🔽 + head 🗿 ^^^ -->



<!-- #region ✂️✂️✂️ SNIPPETS ===================================------------------
____________________ -------->

  <!-- ============================ 
       ✂️✂️✂️✂️SNIPPETS
       ============================ -->


<!-- V1: Snippets Bar (single button) -->
<div id="snippetsBar" class="panel hide-when-editor-maximized">



<!-- 🟧 Bank Header Compact + Dropdown Icon -->
<div id="bankHeader" class=>
  <span class="heading-1 f18-c">Snippets </span>
  <!-- Dropdown button (icon version) -->
 
 
 
<button id="bankSelectBtn" class="btn-clearSVG" title="Select Bank">
    <svg viewBox="-0.55 -0.56 9.05 11.88" class="btn-icon">
      <path 
        d="M1.34,1.34h0c1.46-1.46,3.82-1.46,5.27,0h0c.7.7,1.09,1.65,1.09,2.64v2.82c0,.31-.12.61-.35.83l-2.55,2.55c-.46.46-1.21.46-1.67,0L.6,7.63c-.22-.22-.35-.52-.35-.83v-2.82c0-.99.39-1.94,1.09-2.64Z"
        fill="currentColor"
        stroke-miterlimit="10"

      ></path>
      <line class="inner-contents" x1="5.62" y1="6.85" x2="2.35" y2="3.58" 
        fill="none"
        stroke-linecap="round"
        stroke-linejoin="round"
      ></line>
      <line class="inner-contents" x1="4.03" y1="7.5" x2="2.56" y2="6.03"
        fill="none"
        stroke-linecap="round"
        stroke-linejoin="round"
      ></line>
      <line class="inner-contents" x1="5.38" y1="4.43" x2="3.92" y2="2.97" 
        fill="none"
        stroke-linecap="round"
        stroke-linejoin="round"
      ></line>
    </svg>
  </button>

  <!-- Bank name (editable text) -->
  <span id="bankNameLabel" class="f18-c">Bank 1</span>



  <!-- Context menu for bank actions -->
  <ul id="bankSelectMenu" class="context-menu"></ul>
</div>


  <div class="snippetsRow" id="snippetsRow"></div>
  <label class="checkbox-label text-sm"><input type="checkbox" id="snipLoadControls"></label>
</div>

<!-- Context menu for snippet buttons -->
<ul id="snippetContextMenu" class="context-menu snippet-menu hide-when-editor-maximized">
  <li><button data-action="edit">Edit</button></li>
  <li><button data-action="express">Express...</button></li>
</ul>

<!----_-_-_-_-_-_-_---------------------------------------\--\--->
<!-- #endregion ^^^ End Snippets ✂️ ^^^ -->



  <!-- ============================
       Defunct tab section??-->
  <section id="expressions" class="tab active hide-when-editor-maximized">

  </section>

<!-- #region 🖥️🖥️🖥️ EXPRESS ===================================------------------
____________________ -------->


<!-- Main tab bar for Express | Search -->
<div id="mainTabBar" class="tab-bar hide-when-editor-maximized">
  <button id="tab-express" class="tab-btn active" data-tab="expressArea" aria-controls="expressArea" role="tab" aria-selected="true">Express</button>
  <button id="tab-search" class="tab-btn" data-tab="searchReplacePanel" aria-controls="searchReplacePanel" role="tab" aria-selected="false">Search</button>
</div>

<!-- Tab content wrapper that holds both panels -->
<div id="mainTabContent" class="tab-content">
  <!-- Express panel -->
  <div id="expressArea" class="panel" role="tabpanel" aria-labelledby="tab-express">
    <div class="express-panel-header">
      <span class="heading-1 f18">Express</span>
      <div class="express-panel-actions">
        <button id="editorMaximizeBtn" class="btn-discreet" type="button" aria-label="Maximize editor" aria-pressed="false" title="Maximize editor">
          <span class="icon icon-expand" aria-hidden="true">⤢</span>
          <span class="icon icon-collapse" aria-hidden="true">⤡</span>
          <span class="sr-only">Maximize editor</span>
        </button>
      </div>
    </div>
    <!-- V2: pick UI removed -->
    <!-- Editor row -->
    <div id="codeEditor"></div>
    <!-- Overlay action buttons anchored to the bottom-right of the Express area -->
    <div class="express-editor-overlay" role="group" aria-label="Editor quick actions">

      <button id="loadPathFromSelectionBtn" class="btn-clearSVG express-editor-overlay-btn" type="button" aria-label="Load path from selection" title="Load path from selection">
        <svg viewBox="-0.42 -0.43 19.59 19.02" class="btn-icon">
          <path
            d="M18.37,9.67v8.12s-9.29,0-9.29,0L.52,9.22c-.09-.09-.14-.22-.14-.34V.86c0-.27.22-.49.49-.49h8.01c.13,0,.25.05.34.14l9.15,9.15Z"
            fill="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width=".75"
          />
          <g>
            <line class="inner-contents"
              x1="5.9" y1="5.2" x2="12.85" y2="12.15"
              fill="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width=".75"
            />
            <circle class="inner-contents"
              cx="9.37" cy="8.67" r="1.88"
              fill="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width=".75"
            />
          </g>
        </svg>
      </button>
      <button id="loadFromSelectionBtn" class="btn-clearSVG express-editor-overlay-btn" type="button" aria-label="Load expression from selection" title="Load expression from selection">
        <svg viewBox="-0.42 -0.43 19.59 19.02" class="btn-icon">
          <path
            d="M18.37,9.67v8.12s-9.29,0-9.29,0L.52,9.22c-.09-.09-.14-.22-.14-.34V.86c0-.27.22-.49.49-.49h8.01c.13,0,.25.05.34.14l9.15,9.15Z"
            fill="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width=".75"
          />
          <g>
            <line class="inner-contents"
              x1="12.63" y1="8.09" x2="6.3" y2="8.09"
              fill="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width=".75"
            />
            <line class="inner-contents"
              x1="11.71" y1="10.26" x2="8.88" y2="10.26"
              fill="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width=".75"
            />
            <line class="inner-contents"
              x1="10.05" y1="5.99" x2="7.22" y2="5.99"
              fill="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width=".75"
            />
          </g>
        </svg>
      </button>
      <button id="editorClearBtn" class="btn-clearSVG express-editor-overlay-btn" type="button" aria-label="Clear editor" title="Clear editor">
        <svg viewBox="-0.43 -0.42 25.71 52.68" class="btn-icon">
          <path
            d="M24.48,26.26c-9.38.66-14.29,6.21-23.15,25.2,7.75-19.06,7.67-24.83-.96-25.88,9.38-.66,14.29-6.21,23.15-25.2-7.75,19.06-7.67,24.83.96,25.88Z"
            fill="currentColor"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
      </button>
    </div>
  </div>

  <div id="searchReplacePanel" class="panel search-replace-panel hidden" role="tabpanel" aria-labelledby="tab-search">
    <label for="searchField" class="text-sm block-label">Search</label>
    <input type="text" id="searchField" class="text-input" />
    <label for="replaceField" class="text-sm block-label">Replace</label>
    <input type="text" id="replaceField" class="text-input" />
    <div class="row search-options">
      <label class="checkbox-label text-sm">
        <input type="checkbox" id="matchCase" checked /> Match case
      </label>
    </div>
    <button id="runSearchReplace" class="tab-btn">Run Search &amp; Replace</button>
  </div>
</div>
<!-- #endregion ^^^ End Express 🖥️ ^^^ -->


<!-- #region 🎛️🎛️🎛️ Express CONTROLS ===================================------------------
____________________ -------->


  <!-- =============== Main button Row ==============-->
	<!-- =======================[+]=====================-->
	
	
<div id="expressControls" class="express-controls">
    <div class="row btns">
<!--
  Target Selected button 
<div class="target-btn-wrapper">
  <button id="targetSelectedBtn" class="circle-btn"></button>
  <div class="label-under">Target<br>Selected</div>
</div>



<div class="target-btn-wrapper">
  <button id="targetSelectedBtn" class="circle-btn"></button>
  <div class="label-under">Target<br>Selected</div>
</div>

-->
  <!-- ============ Absolute vs Relative ☑️ ==============-->
	<!-- ======================[___?]=====================-->

</div>
    
<label class="checkbox-label text-sm"><input type="checkbox" id="useAbsoluteComp"> Use comp name instead of thisComp</label>


    <!-- ============ Custom Name Searching ☑️==============-->
	<!-- ======================[___?]=====================-->

    <!-- Custom Search controls -->
    <div class="row">
      <label class="checkbox-label text-sm">
  <input type="checkbox" id="useCustomSearch" /> Custom search
</label>
    </div>
    <div class="row">
      <input type="text" id="customSearch" placeholder="e.g. Stroke 1 > Opacity" disabled />
    </div>

</div>

<!----_-_-_-_-_-_-_---------------------------------------\--\--->
<!-- #endregion ^^^ End Controls ^^^ -->


<!-- #region 🔵🔵🔵 APPLY ===================================------------------
____________________ -------->


    <!-- Apply buttons -->
<div id="expressApplyRow" class="express-apply">
    <div class="row btns apply-row">
  


<!-- 🟧🟧🟧 Rhombus Button -->
<!-- 🟧 Unified rhombus button -->
<button id="applyBtn" class="btn-rhombus f18-c holy-glow">
  <svg class="rhombus-icon"
       xmlns="http://www.w3.org/2000/svg"
       width="63.25" height="20.08"
       viewBox="-0.75 -0.75 63.25 20.08">

    <!-- Left section -->
    <g class="rhombus-left">
      <path d="M7.47.5h-3.69C1.54.5-.04,2.69.67,4.82l3.69,11.02c.45,1.34,1.7,2.24,3.11,2.24" />
    </g>

    <!-- Middle section -->
    <g class="rhombus-mid">
      <rect x="7.47" y="0.5" width="46.8" height="18.08"
            fill="currentColor" stroke="none" />
      <line x1="7.47" y1="0.5"  x2="54.27" y2="0.5" />
      <line x1="7.47" y1="18.08" x2="54.27" y2="18.08" />
    </g>

    <!-- Right section -->
    <g class="rhombus-right">
      <path d="M54.27,18.08h3.69c2.24,0,3.82-2.19,3.11-4.32L57.38,2.74C56.93,1.4,55.68.5,54.27.5" />
    </g>
  </svg>

  <span class="label">APPLY</span>
</button>

      <!--<button id="applyTargetBtn" class="apply-target-btn">Apply</button>-->
    </div>
</div>

  <!-- ================ Romby boi ==============-->
	<!-- =======================[+]=====================-->


    
<!----_-_-_-_-_-_-_---------------------------------------\--\--->
<!-- #endregion ^^^ End Apply 🔵 ^^^ -->


<!-- #region ⚪⚪⚪ MISC ===================================------------------
____________________ -------->




    <!-- Apply Report toggle + box -->
<div id="expressMisc" class="express-misc">
    <div class="row">
      <button id="openApplyLog" class="log-button text-sm" title="Open Apply Log">Log</button>
      <button id="openThemePicker" class="btn-theme text-sm" title="Adjust Theme Color">Theme</button>
    </div>

<!-- Target box
    <div id="TargetBox" class="panel shade-hard">
    <div id="TargetList">No results yet</div>
    </div>
 -->
  <!-- Toast -->
  <footer id="toast"></footer>



    <!-- V2: pick UI removed -->


 <!----_-_-_-_-_-_-_---------------------------------------\--\--->
<!-- #endregion ^^^ End Misc ⚪ ^^^ -->

  </div>

  </div> <!-- end appRoot -->


 <script>
(function initThemePickerPanel() {
  'use strict';

  const button = document.getElementById('openThemePicker');
  if (!button || typeof CSInterface !== 'function') {
    return;
  }

  button.addEventListener('click', (event) => {
    event.preventDefault();
    try {
      const cs = new CSInterface();
      cs.openExtension('com.holy.expressor.colorpicker', 'Modeless');
    } catch (err) {
      console.warn('Failed to open color picker panel', err);
    }
  });
})();
</script>

 <script>
  document.addEventListener('DOMContentLoaded', () => {
    console.log('Holy Expressor Base Path →', window.location.href);
  });
</script>

</body>

</html>
